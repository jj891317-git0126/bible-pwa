<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0f172a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <title>ì„±ê²½ í†µë… (í‰ì¼ 1ë…„)</title>

  <style>
    :root { color-scheme: light; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Noto Sans KR", Arial, sans-serif;
      margin: 0; background: #ffffff; color: #0f172a;
    }
    header {
      position: sticky; top: 0; z-index: 10;
      background: #fff; padding: 14px 16px; border-bottom: 1px solid #eee;
    }
    h1 { margin: 0; font-size: 18px; }
    .sub { margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    .pill { background: #f1f5f9; padding: 6px 10px; border-radius: 999px; font-size: 13px; color: #334155; }
    .btn {
      border: 1px solid #e2e8f0; background: #fff;
      padding: 7px 10px; border-radius: 10px; cursor: pointer;
      font-size: 13px; color: #0f172a;
    }
    .btn:active { transform: scale(0.99); }
    .btnDanger { border-color: #fecaca; }
    .btnPrimary { border-color: #cbd5e1; background: #0f172a; color: #fff; }
    .search { width: 100%; margin-top: 10px; display: flex; gap: 8px; }
    input[type="text"] {
      flex: 1; padding: 10px 12px; border: 1px solid #e2e8f0;
      border-radius: 12px; font-size: 14px;
    }
    input[type="date"] {
      padding: 8px 10px; border: 1px solid #e2e8f0;
      border-radius: 10px; font-size: 13px;
    }
    select {
      padding: 8px 10px; border: 1px solid #e2e8f0;
      border-radius: 10px; font-size: 13px; background: #fff;
    }
    main { padding: 8px 0 60px; }
    .row {
      display: flex; gap: 12px; padding: 14px 16px;
      border-bottom: 1px solid #f1f5f9; align-items: center;
    }
    .row.done { background: #f6fff6; }
    .day {
      width: 86px; font-weight: 800; font-size: 13px;
      white-space: pre-line; color: #0f172a;
    }
    .title { flex: 1; }
    .title .t1 { font-size: 14px; font-weight: 800; }
    .title .t2 { margin-top: 5px; font-size: 12px; color: #475569; line-height: 1.35; }
    .check { font-size: 20px; }
    .hint { margin-top: 8px; font-size: 12px; color: #64748b; }

    /* ì¶•í•˜ ëª¨ë‹¬ */
    .overlay {
      position: fixed; inset: 0; background: rgba(15, 23, 42, 0.45);
      display: none; align-items: center; justify-content: center; padding: 18px;
      z-index: 999;
    }
    .modal {
      width: min(420px, 100%);
      background: #fff; border-radius: 18px; padding: 16px 16px 14px;
      box-shadow: 0 18px 60px rgba(0,0,0,0.2);
    }
    .modal h2 { margin: 0; font-size: 18px; }
    .modal p { margin: 10px 0 0; font-size: 13px; color: #334155; line-height: 1.45; }
    .modal .actions { margin-top: 14px; display: flex; justify-content: flex-end; }
  </style>
</head>

<body>
  <header>
    <h1>ì„±ê²½ í†µë… (í‰ì¼ 1ë…„)</h1>

    <div class="sub">
      <span class="pill" id="todayBox">ì˜¤ëŠ˜ ë¶„ëŸ‰: -</span>
      <button class="btn btnPrimary" id="goTodayBtn">ì˜¤ëŠ˜ ì´ë™</button>
      <span class="pill" id="progressAll">ì „ì²´: -</span>
      <span class="pill" id="progressOT">êµ¬ì•½: -</span>
      <span class="pill" id="progressNT">ì‹ ì•½: -</span>
    </div>

    <div class="sub">
      <label class="btn">
        ì‹œì‘ì¼
        <input id="startDate" type="date" />
      </label>

      <select id="viewMode">
        <option value="all">ì „ì²´ ë³´ê¸°</option>
        <option value="todo">ë¯¸ì™„ë£Œë§Œ</option>
        <option value="done">ì™„ë£Œë§Œ</option>
      </select>

      <button class="btn" id="exportBtn">ë°±ì—… ë‚´ë³´ë‚´ê¸°</button>

      <label class="btn">
        ë°±ì—… ê°€ì ¸ì˜¤ê¸°
        <input id="importFile" type="file" accept="application/json" style="display:none" />
      </label>

      <button class="btn btnDanger" id="resetBtn">ì „ì²´ ì²´í¬ ì´ˆê¸°í™”</button>
    </div>

    <div class="search">
      <input id="q" type="text" placeholder="ê²€ìƒ‰: ì°½ì„¸ê¸°, ìš”í•œë³µìŒ, Day 120" />
      <button class="btn" id="clearSearch">ì§€ìš°ê¸°</button>
    </div>

    <div class="hint">
      ê·œì¹™: <b>ì£¼ë§(í† /ì¼) ì œì™¸</b>. ì‹œì‘ì¼ ê¸°ì¤€ìœ¼ë¡œ Dayë§ˆë‹¤ ë‚ ì§œê°€ ìë™ í‘œì‹œë©ë‹ˆë‹¤.
    </div>
  </header>

  <main id="list"></main>

  <!-- ì¶•í•˜ ëª¨ë‹¬ -->
  <div class="overlay" id="overlay">
    <div class="modal" role="dialog" aria-modal="true">
      <h2 id="celebrateTitle">ğŸ‰ í•œ ë‹¬ ì™„ë£Œ!</h2>
      <p id="celebrateBody">ì´ë²ˆ ë‹¬ ì½ê¸° í”Œëœì„ ëª¨ë‘ ì™„ë£Œí•˜ì…¨ì–´ìš”. ê³„ì† ì´ì–´ê°€ ë³´ì„¸ìš”!</p>
      <div class="actions">
        <button class="btn btnPrimary" id="celebrateClose">í™•ì¸</button>
      </div>
    </div>
  </div>

  <script>
    // ---- Storage Keys
    const STORAGE_CHECKS = "bible_reading_checks_v3";
    const STORAGE_START  = "bible_start_date_v3";
    const STORAGE_CELEB  = "bible_month_celebrated_v3"; // { "2026-01": true, ... }

    // ---- State
    let PLAN = [];
    let CHECKS = {};
    let FILTER = "";
    let VIEW_MODE = "all";

    // Day -> Date objects / labels
    let DAY_TO_DATE_OBJ = {};  // { 1: Date, 2: Date, ... }
    let DAY_TO_DATE_STR = {};  // { 1: "1/1/26", ... }

    // MonthKey -> day numbers in that month
    let MONTH_TO_DAYS = {}; // { "2026-01": [1,2,...], ... }

    // ---- NT books (OT/NT progress)
    const NT_BOOKS = new Set([
      "Matthew","Mark","Luke","John","Acts","Romans",
      "1 Corinthians","2 Corinthians","Galatians","Ephesians","Philippians","Colossians",
      "1 Thessalonians","2 Thessalonians","1 Timothy","2 Timothy","Titus","Philemon",
      "Hebrews","James","1 Peter","2 Peter","1 John","2 John","3 John","Jude","Revelation"
    ]);

    // ---- Korean book names
    const BOOK_KO = {
      "Genesis":"ì°½ì„¸ê¸°","Exodus":"ì¶œì• êµ½ê¸°","Leviticus":"ë ˆìœ„ê¸°","Numbers":"ë¯¼ìˆ˜ê¸°","Deuteronomy":"ì‹ ëª…ê¸°",
      "Joshua":"ì—¬í˜¸ìˆ˜ì•„","Judges":"ì‚¬ì‚¬ê¸°","Ruth":"ë£»ê¸°","1 Samuel":"ì‚¬ë¬´ì—˜ìƒ","2 Samuel":"ì‚¬ë¬´ì—˜í•˜",
      "1 Kings":"ì—´ì™•ê¸°ìƒ","2 Kings":"ì—´ì™•ê¸°í•˜","1 Chronicles":"ì—­ëŒ€ìƒ","2 Chronicles":"ì—­ëŒ€í•˜",
      "Ezra":"ì—ìŠ¤ë¼","Nehemiah":"ëŠí—¤ë¯¸ì•¼","Esther":"ì—ìŠ¤ë”","Job":"ìš¥ê¸°","Psalms":"ì‹œí¸",
      "Proverbs":"ì ì–¸","Ecclesiastes":"ì „ë„ì„œ","Song of Solomon":"ì•„ê°€","Isaiah":"ì´ì‚¬ì•¼",
      "Jeremiah":"ì˜ˆë ˆë¯¸ì•¼","Lamentations":"ì˜ˆë ˆë¯¸ì•¼ì• ê°€","Ezekiel":"ì—ìŠ¤ê²”","Daniel":"ë‹¤ë‹ˆì—˜",
      "Hosea":"í˜¸ì„¸ì•„","Joel":"ìš”ì—˜","Amos":"ì•„ëª¨ìŠ¤","Obadiah":"ì˜¤ë°”ëŒœ","Jonah":"ìš”ë‚˜",
      "Micah":"ë¯¸ê°€","Nahum":"ë‚˜í›”","Habakkuk":"í•˜ë°•êµ­","Zephaniah":"ìŠ¤ë°”ëƒ","Haggai":"í•™ê°œ",
      "Zechariah":"ìŠ¤ê°€ë´","Malachi":"ë§ë¼ê¸°",
      "Matthew":"ë§ˆíƒœë³µìŒ","Mark":"ë§ˆê°€ë³µìŒ","Luke":"ëˆ„ê°€ë³µìŒ","John":"ìš”í•œë³µìŒ","Acts":"ì‚¬ë„í–‰ì „",
      "Romans":"ë¡œë§ˆì„œ","1 Corinthians":"ê³ ë¦°ë„ì „ì„œ","2 Corinthians":"ê³ ë¦°ë„í›„ì„œ","Galatians":"ê°ˆë¼ë””ì•„ì„œ",
      "Ephesians":"ì—ë² ì†Œì„œ","Philippians":"ë¹Œë¦½ë³´ì„œ","Colossians":"ê³¨ë¡œìƒˆì„œ",
      "1 Thessalonians":"ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ","2 Thessalonians":"ë°ì‚´ë¡œë‹ˆê°€í›„ì„œ",
      "1 Timothy":"ë””ëª¨ë°ì „ì„œ","2 Timothy":"ë””ëª¨ë°í›„ì„œ","Titus":"ë””ë„ì„œ","Philemon":"ë¹Œë ˆëª¬ì„œ",
      "Hebrews":"íˆë¸Œë¦¬ì„œ","James":"ì•¼ê³ ë³´ì„œ","1 Peter":"ë² ë“œë¡œì „ì„œ","2 Peter":"ë² ë“œë¡œí›„ì„œ",
      "1 John":"ìš”í•œì¼ì„œ","2 John":"ìš”í•œì´ì„œ","3 John":"ìš”í•œì‚¼ì„œ","Jude":"ìœ ë‹¤ì„œ","Revelation":"ìš”í•œê³„ì‹œë¡"
    };

    function bookName(en) { return BOOK_KO[en] || en; }
    function isNT(bookEn) { return NT_BOOKS.has(bookEn); }

    // ---- Dates / weekdays
    function isWeekend(d){ const x=d.getDay(); return x===0 || x===6; }
    function toDateOnly(d){ return new Date(d.getFullYear(), d.getMonth(), d.getDate()); }

    // M/D/YY (ì˜ˆ: 1/1/26)
    function fmtMDYY(d){
      const mm = d.getMonth()+1;
      const dd = d.getDate();
      const yy = String(d.getFullYear()).slice(-2);
      return `${mm}/${dd}/${yy}`;
    }
    function monthKey(d){
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      return `${y}-${m}`; // e.g., 2026-01
    }
    function monthLabelKo(key){
      const [y,m] = key.split("-");
      return `${y}ë…„ ${parseInt(m,10)}ì›”`;
    }

    // ---- Load/Save
    function loadChecks() {
      try { CHECKS = JSON.parse(localStorage.getItem(STORAGE_CHECKS) || "{}") || {}; }
      catch { CHECKS = {}; }
    }
    function saveChecks() {
      localStorage.setItem(STORAGE_CHECKS, JSON.stringify(CHECKS));
      updateStats();
      updateTodayBox();
      maybeCelebrateMonthlyCompletion();
    }
