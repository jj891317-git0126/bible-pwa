<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0f172a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <title>ì„±ê²½ í†µë… (í‰ì¼ 1ë…„)</title>

  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Apple SD Gothic Neo", "Noto Sans KR", Arial, sans-serif;
      margin: 0; background: #ffffff; color: #0f172a;
    }
    header {
      position: sticky; top: 0; z-index: 10;
      background: #fff; padding: 14px 16px; border-bottom: 1px solid #eee;
    }
    h1 { margin: 0; font-size: 18px; }
    .sub { margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    .pill { background: #f1f5f9; padding: 6px 10px; border-radius: 999px; font-size: 13px; color: #334155; }
    .btn {
      border: 1px solid #e2e8f0; background: #fff;
      padding: 7px 10px; border-radius: 10px; cursor: pointer;
      font-size: 13px; color: #0f172a;
    }
    .btn:active { transform: scale(0.99); }
    .btnDanger { border-color: #fecaca; }
    .btnPrimary { border-color: #cbd5e1; background: #0f172a; color: #fff; }
    .search { width: 100%; margin-top: 10px; display: flex; gap: 8px; }
    input[type="text"] {
      flex: 1; padding: 10px 12px; border: 1px solid #e2e8f0;
      border-radius: 12px; font-size: 14px;
    }
    input[type="date"] {
      padding: 8px 10px; border: 1px solid #e2e8f0;
      border-radius: 10px; font-size: 13px;
    }
    select {
      padding: 8px 10px; border: 1px solid #e2e8f0;
      border-radius: 10px; font-size: 13px; background: #fff;
    }
    main { padding: 8px 0 60px; }
    .row {
      display: flex; gap: 12px; padding: 14px 16px;
      border-bottom: 1px solid #f1f5f9; align-items: center;
    }
    .row.done { background: #f6fff6; }
    .day {
      width: 92px; font-weight: 900; font-size: 13px;
      white-space: pre-line;
    }
    .title { flex: 1; }
    .title .t1 { font-size: 14px; font-weight: 900; }
    .title .t2 { margin-top: 5px; font-size: 12px; color: #475569; line-height: 1.35; }
    .check { font-size: 20px; }

    /* ì¶•í•˜ ëª¨ë‹¬ */
    .overlay {
      position: fixed; inset: 0; background: rgba(15, 23, 42, 0.45);
      display: none; align-items: center; justify-content: center; padding: 18px;
      z-index: 999;
    }
    .modal {
      width: min(420px, 100%);
      background: #fff; border-radius: 18px; padding: 16px 16px 14px;
      box-shadow: 0 18px 60px rgba(0,0,0,0.2);
    }
    .modal h2 { margin: 0; font-size: 18px; }
    .modal p { margin: 10px 0 0; font-size: 13px; color: #334155; line-height: 1.45; }
    .modal .actions { margin-top: 14px; display: flex; justify-content: flex-end; }
  </style>
</head>

<body>
  <header>
    <h1>ì„±ê²½ í†µë… (í‰ì¼ 1ë…„)</h1>

    <div class="sub">
      <span class="pill" id="todayBox">ì˜¤ëŠ˜ ë¶„ëŸ‰: -</span>
      <button class="btn btnPrimary" id="goTodayBtn">ì˜¤ëŠ˜ ì´ë™</button>
      <span class="pill" id="progressAll">ì „ì²´: -</span>
      <span class="pill" id="progressOT">êµ¬ì•½: -</span>
      <span class="pill" id="progressNT">ì‹ ì•½: -</span>
    </div>

    <div class="sub">
      <label class="btn">
        ì‹œì‘ì¼
        <input id="startDate" type="date" />
      </label>

      <select id="viewMode">
        <option value="all">ì „ì²´ ë³´ê¸°</option>
        <option value="todo">ë¯¸ì™„ë£Œë§Œ</option>
        <option value="done">ì™„ë£Œë§Œ</option>
      </select>

      <button class="btn" id="exportBtn">ë°±ì—… ë‚´ë³´ë‚´ê¸°</button>

      <label class="btn">
        ë°±ì—… ê°€ì ¸ì˜¤ê¸°
        <input id="importFile" type="file" accept="application/json" style="display:none" />
      </label>

      <button class="btn btnDanger" id="resetBtn">ì „ì²´ ì²´í¬ ì´ˆê¸°í™”</button>
    </div>

    <div class="search">
      <input id="q" type="text" placeholder="ê²€ìƒ‰: ì°½ì„¸ê¸°, ìš”í•œë³µìŒ, Day 120, 1/1/26" />
      <button class="btn" id="clearSearch">ì§€ìš°ê¸°</button>
    </div>
  </header>

  <main id="list"></main>

  <!-- ì¶•í•˜ ëª¨ë‹¬ -->
  <div class="overlay" id="overlay">
    <div class="modal" role="dialog" aria-modal="true">
      <h2 id="celebrateTitle">ğŸ‰ í•œ ë‹¬ ì™„ë£Œ!</h2>
      <p id="celebrateBody">ì´ë²ˆ ë‹¬ ì½ê¸° í”Œëœì„ ëª¨ë‘ ì™„ë£Œí•˜ì…¨ì–´ìš”. ê³„ì† ì´ì–´ê°€ ë³´ì„¸ìš”!</p>
      <div class="actions">
        <button class="btn btnPrimary" id="celebrateClose">í™•ì¸</button>
      </div>
    </div>
  </div>

  <script>
    // ---- Storage Keys
    const STORAGE_CHECKS = "bible_reading_checks_v4";
    const STORAGE_START  = "bible_start_date_v4";
    const STORAGE_CELEB  = "bible_month_celebrated_v4"; // { "2026-01": true, ... }

    // ---- State
    let PLAN = [];
    let CHECKS = {};
    let FILTER = "";
    let VIEW_MODE = "all";

    // Day -> Date label
    let DAY_TO_DATE_STR = {};   // { 1: "1/1/26", ... }
    let MONTH_TO_DAYS = {};     // { "2026-01": [day, ...], ... }

    // ---- NT books (OT/NT progress)
    const NT_BOOKS = new Set([
      "Matthew","Mark","Luke","John","Acts","Romans",
      "1 Corinthians","2 Corinthians","Galatians","Ephesians","Philippians","Colossians",
      "1 Thessalonians","2 Thessalonians","1 Timothy","2 Timothy","Titus","Philemon",
      "Hebrews","James","1 Peter","2 Peter","1 John","2 John","3 John","Jude","Revelation"
    ]);

    // ---- Korean book names
    const BOOK_KO = {
      "Genesis":"ì°½ì„¸ê¸°","Exodus":"ì¶œì• êµ½ê¸°","Leviticus":"ë ˆìœ„ê¸°","Numbers":"ë¯¼ìˆ˜ê¸°","Deuteronomy":"ì‹ ëª…ê¸°",
      "Joshua":"ì—¬í˜¸ìˆ˜ì•„","Judges":"ì‚¬ì‚¬ê¸°","Ruth":"ë£»ê¸°","1 Samuel":"ì‚¬ë¬´ì—˜ìƒ","2 Samuel":"ì‚¬ë¬´ì—˜í•˜",
      "1 Kings":"ì—´ì™•ê¸°ìƒ","2 Kings":"ì—´ì™•ê¸°í•˜","1 Chronicles":"ì—­ëŒ€ìƒ","2 Chronicles":"ì—­ëŒ€í•˜",
      "Ezra":"ì—ìŠ¤ë¼","Nehemiah":"ëŠí—¤ë¯¸ì•¼","Esther":"ì—ìŠ¤ë”","Job":"ìš¥ê¸°","Psalms":"ì‹œí¸",
      "Proverbs":"ì ì–¸","Ecclesiastes":"ì „ë„ì„œ","Song of Solomon":"ì•„ê°€","Isaiah":"ì´ì‚¬ì•¼",
      "Jeremiah":"ì˜ˆë ˆë¯¸ì•¼","Lamentations":"ì˜ˆë ˆë¯¸ì•¼ì• ê°€","Ezekiel":"ì—ìŠ¤ê²”","Daniel":"ë‹¤ë‹ˆì—˜",
      "Hosea":"í˜¸ì„¸ì•„","Joel":"ìš”ì—˜","Amos":"ì•„ëª¨ìŠ¤","Obadiah":"ì˜¤ë°”ëŒœ","Jonah":"ìš”ë‚˜",
      "Micah":"ë¯¸ê°€","Nahum":"ë‚˜í›”","Habakkuk":"í•˜ë°•êµ­","Zephaniah":"ìŠ¤ë°”ëƒ","Haggai":"í•™ê°œ",
      "Zechariah":"ìŠ¤ê°€ë´","Malachi":"ë§ë¼ê¸°",
      "Matthew":"ë§ˆíƒœë³µìŒ","Mark":"ë§ˆê°€ë³µìŒ","Luke":"ëˆ„ê°€ë³µìŒ","John":"ìš”í•œë³µìŒ","Acts":"ì‚¬ë„í–‰ì „",
      "Romans":"ë¡œë§ˆì„œ","1 Corinthians":"ê³ ë¦°ë„ì „ì„œ","2 Corinthians":"ê³ ë¦°ë„í›„ì„œ","Galatians":"ê°ˆë¼ë””ì•„ì„œ",
      "Ephesians":"ì—ë² ì†Œì„œ","Philippians":"ë¹Œë ˆë¦½ë³´ì„œ","Colossians":"ê³¨ë¡œìƒˆì„œ",
      "1 Thessalonians":"ë°ì‚´ë¡œë‹ˆê°€ì „ì„œ","2 Thessalonians":"ë°ì‚´ë¡œë‹ˆê°€í›„ì„œ",
      "1 Timothy":"ë””ëª¨ë°ì „ì„œ","2 Timothy":"ë””ëª¨ë°í›„ì„œ","Titus":"ë””ë„ì„œ","Philemon":"ë¹Œë ˆëª¬ì„œ",
      "Hebrews":"íˆë¸Œë¦¬ì„œ","James":"ì•¼ê³ ë³´ì„œ","1 Peter":"ë² ë“œë¡œì „ì„œ","2 Peter":"ë² ë“œë¡œí›„ì„œ",
      "1 John":"ìš”í•œì¼ì„œ","2 John":"ìš”í•œì´ì„œ","3 John":"ìš”í•œì‚¼ì„œ","Jude":"ìœ ë‹¤ì„œ","Revelation":"ìš”í•œê³„ì‹œë¡"
    };

    function bookName(en) { return BOOK_KO[en] || en; }
    function isNT(bookEn) { return NT_BOOKS.has(bookEn); }

    // ---- Dates
    function toDateOnly(d){ return new Date(d.getFullYear(), d.getMonth(), d.getDate()); }
    function isWeekend(d){ const x=d.getDay(); return x===0 || x===6; }

    // 1/1/26 í˜•íƒœ
    function fmtMDYY(d){
      const mm = d.getMonth()+1;
      const dd = d.getDate();
      const yy = String(d.getFullYear()).slice(-2);
      return `${mm}/${dd}/${yy}`;
    }
    function monthKey(d){
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      return `${y}-${m}`;
    }
    function monthLabelKo(key){
      const [y,m] = key.split("-");
      return `${y}ë…„ ${parseInt(m,10)}ì›”`;
    }

    // ---- Load/Save
    function loadChecks() {
      try { CHECKS = JSON.parse(localStorage.getItem(STORAGE_CHECKS) || "{}") || {}; }
      catch { CHECKS = {}; }
    }
    function saveChecks() {
      localStorage.setItem(STORAGE_CHECKS, JSON.stringify(CHECKS));
      updateStats();
      updateTodayBox();
      maybeCelebrateMonthlyCompletion();
    }

    function readingTitleKo(item){
      let t = item.title || "";
      for (const [en, ko] of Object.entries(BOOK_KO)) {
        t = t.split(en).join(ko);
      }
      return t;
    }
    function readingDetailKo(item){
      if (item.type !== "read") return "ë°€ë¦° ë¶„ëŸ‰ì„ ë”°ë¼ì¡ê±°ë‚˜, ë³µìŠµ/ë¬µìƒìš©ìœ¼ë¡œ ì‚¬ìš©í•˜ì„¸ìš”.";
      return item.readings.map(r => `${bookName(r.book)} ${r.chapter}ì¥`).join(", ");
    }

    function matchesFilter(item) {
      if (VIEW_MODE === "done" && !CHECKS[item.day]) return false;
      if (VIEW_MODE === "todo" && !!CHECKS[item.day]) return false;

      if (!FILTER) return true;
      const f = FILTER.toLowerCase();
      const hay = [
        `day ${item.day}`,
        readingTitleKo(item),
        readingDetailKo(item),
        (DAY_TO_DATE_STR[item.day] || "")
      ].join(" ").toLowerCase();
      return hay.includes(f);
    }

    // ---- Build Day->Date maps (weekdays only)
    function rebuildMapsIfPossible(){
      DAY_TO_DATE_STR = {};
      MONTH_TO_DAYS = {};

      const startDateStr = (localStorage.getItem(STORAGE_START) || document.getElementById("startDate").value || "").trim();
      if (!startDateStr) return;

      let d = toDateOnly(new Date(startDateStr));
      while (isWeekend(d)) d.setDate(d.getDate() + 1);

      for (let day = 1; day <= PLAN.length; day++){
        while (isWeekend(d)) d.setDate(d.getDate() + 1);

        const label = fmtMDYY(d);
        DAY_TO_DATE_STR[day] = label;

        const mk = monthKey(d);
        if (!MONTH_TO_DAYS[mk]) MONTH_TO_DAYS[mk] = [];
        MONTH_TO_DAYS[mk].push(day);

        d.setDate(d.getDate() + 1);
      }
    }

    // ---- Today day index and scroll
    function dayIndexFromStartSkippingWeekends(startDateStr, todayDate){
      let d = toDateOnly(new Date(startDateStr));
      let t = toDateOnly(new Date(todayDate));

      while (isWeekend(d)) d.setDate(d.getDate() + 1);

      let count = 0;
      while (d <= t) {
        if (!isWeekend(d)) count++;
        d.setDate(d.getDate() + 1);
      }
      return count;
    }

    function updateTodayBox(){
      const box = document.getElementById("todayBox");
      const start = localStorage.getItem(STORAGE_START) || document.getElementById("startDate").value;

      if (!start) {
        box.textContent = "ì˜¤ëŠ˜ ë¶„ëŸ‰: ì‹œì‘ì¼ì„ ì„¤ì •í•˜ì„¸ìš”";
        return;
      }

      const dayNum = dayIndexFromStartSkippingWeekends(start, new Date());
      const item = PLAN.find(p => Number(p.day) === Number(dayNum));

      if (!item) {
        if (dayNum > PLAN.length) box.textContent = "ì˜¤ëŠ˜ ë¶„ëŸ‰: ì™„ë£Œ!";
        else box.textContent = `ì˜¤ëŠ˜ ë¶„ëŸ‰: Day ${dayNum}`;
        return;
      }

      const title = (item.type === "buffer") ? "ë”°ë¼ì¡ê¸°/ë³µìŠµ" : readingTitleKo(item);
      const dateStr = DAY_TO_DATE_STR[dayNum] ? ` Â· ${DAY_TO_DATE_STR[dayNum]}` : "";
      box.textContent = `ì˜¤ëŠ˜ ë¶„ëŸ‰: Day ${dayNum}${dateStr} Â· ${title}`;
    }

    function scrollToDay(dayNum){
      const el = document.getElementById(`day-${dayNum}`);
      if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    // ---- Stats
    function updateStats() {
      const total = PLAN.length;
      const done = Object.values(CHECKS).filter(Boolean).length;
      const pct = total ? Math.round((done/total)*100) : 0;
      document.getElementById("progressAll").textContent = `ì „ì²´: ${done}/${total} (${pct}%)`;

      let otTotal=0, otDone=0, ntTotal=0, ntDone=0;
      for (const item of PLAN) {
        if (item.type !== "read" || !item.readings || item.readings.length===0) continue;
        const firstBook = item.readings[0].book;
        const doneThis = !!CHECKS[item.day];
        if (isNT(firstBook)) {
          ntTotal++; if (doneThis) ntDone++;
        } else {
          otTotal++; if (doneThis) otDone++;
        }
      }
      const otPct = otTotal ? Math.round((otDone/otTotal)*100) : 0;
      const ntPct = ntTotal ? Math.round((ntDone/ntTotal)*100) : 0;

      document.getElementById("progressOT").textContent = `êµ¬ì•½: ${otDone}/${otTotal} (${otPct}%)`;
      document.getElementById("progressNT").textContent = `ì‹ ì•½: ${ntDone}/${ntTotal} (${ntPct}%)`;
    }

    // ---- Monthly celebration
    function getCelebratedMap(){
      try { return JSON.parse(localStorage.getItem(STORAGE_CELEB) || "{}") || {}; }
      catch { return {}; }
    }
    function setCelebratedMap(obj){
      localStorage.setItem(STORAGE_CELEB, JSON.stringify(obj));
    }
    function showCelebrate(monthKeyStr){
      const overlay = document.getElementById("overlay");
      document.getElementById("celebrateTitle").textContent = `ğŸ‰ ${monthLabelKo(monthKeyStr)} ì™„ë£Œ!`;
      document.getElementById("celebrateBody").textContent =
        "ì´ë²ˆ ë‹¬ì— í•´ë‹¹í•˜ëŠ” Dayë¥¼ ëª¨ë‘ ì²´í¬í•˜ì…¨ì–´ìš”. ì •ë§ ì˜í•˜ì…¨ìŠµë‹ˆë‹¤! ë‹¤ìŒ ë‹¬ë„ í˜ë‚´ì„¸ìš”.";
      overlay.style.display = "flex";
    }

    function maybeCelebrateMonthlyCompletion(){
      if (!Object.keys(MONTH_TO_DAYS).length) return;

      const celebrated = getCelebratedMap();
      for (const mk of Object.keys(MONTH_TO_DAYS)) {
        if (celebrated[mk]) continue;

        const days = MONTH_TO_DAYS[mk] || [];
        if (days.length === 0) continue;

        const allDone = days.every(d => !!CHECKS[d]);
        if (allDone) {
          celebrated[mk] = true;
          setCelebratedMap(celebrated);
          showCelebrate(mk);
          break; // í•œ ë²ˆì— í•˜ë‚˜ë§Œ
        }
      }
    }

    // ---- Render
    function render() {
      const root = document.getElementById("list");
      root.innerHTML = "";

      const frag = document.createDocumentFragment();

      for (const item of PLAN) {
        const dayNum = Number(item.day);
        if (!matchesFilter(item)) continue;

        const isDone = !!CHECKS[dayNum];

        const row = document.createElement("div");
        row.className = "row" + (isDone ? " done" : "");
        row.id = `day-${dayNum}`;

        row.addEventListener("click", () => {
          CHECKS[dayNum] = !CHECKS[dayNum];
          saveChecks();
          render();
        });

        const day = document.createElement("div");
        day.className = "day";
        const dateStr = DAY_TO_DATE_STR[dayNum] ? `\n${DAY_TO_DATE_STR[dayNum]}` : "";
        day.textContent = `Day ${dayNum}${dateStr}`;

        const title = document.createElement("div");
        title.className = "title";

        const t1 = document.createElement("div");
        t1.className = "t1";
        t1.textContent = item.type === "buffer" ? "ë”°ë¼ì¡ê¸°/ë³µìŠµ" : readingTitleKo(item);

        const t2 = document.createElement("div");
        t2.className = "t2";
        t2.textContent = readingDetailKo(item);

        const check = document.createElement("div");
        check.className = "check";
        check.textContent = isDone ? "âœ…" : "â¬œï¸";

        title.appendChild(t1);
        title.appendChild(t2);

        row.appendChild(day);
        row.appendChild(title);
        row.appendChild(check);

        frag.appendChild(row);
      }

      root.appendChild(frag);
    }

    // ---- Backup
    function exportBackup(){
      const payload = {
        savedAt: new Date().toISOString(),
        checks: CHECKS,
        startDate: localStorage.getItem(STORAGE_START) || document.getElementById("startDate").value || null,
        celebratedMonths: getCelebratedMap()
      };
      const blob = new Blob([JSON.stringify(payload, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "bible-check-backup.json";
      a.click();
      URL.revokeObjectURL(url);
    }
    async function importBackup(file){
      const text = await file.text();
      const parsed = JSON.parse(text);
      if (!parsed || typeof parsed !== "object" || !parsed.checks) throw new Error("í˜•ì‹ ì˜¤ë¥˜");

      CHECKS = parsed.checks || {};
      localStorage.setItem(STORAGE_CHECKS, JSON.stringify(CHECKS));

      if (parsed.startDate) {
        localStorage.setItem(STORAGE_START, parsed.startDate);
        document.getElementById("startDate").value = parsed.startDate;
      }
      if (parsed.celebratedMonths) {
        localStorage.setItem(STORAGE_CELEB, JSON.stringify(parsed.celebratedMonths));
      }

      rebuildMapsIfPossible();
      updateStats();
      updateTodayBox();
      render();
      maybeCelebrateMonthlyCompletion();
    }

    // ---- Init
    async function init(){
      loadChecks();

      const res = await fetch("./plan.json", { cache: "no-store" });
      const data = await res.json();
      PLAN = data.plan || [];

      // restore start date to input
      const savedStart = localStorage.getItem(STORAGE_START);
      if (savedStart) document.getElementById("startDate").value = savedStart;

      // Always rebuild maps if start date exists
      rebuildMapsIfPossible();

      updateStats();
      updateTodayBox();
      render();
      maybeCelebrateMonthlyCompletion();

      if ("serviceWorker" in navigator) navigator.serviceWorker.register("./sw.js");
    }

    // ---- Events
    document.getElementById("resetBtn").addEventListener("click", () => {
      if (!confirm("ì •ë§ ì „ì²´ ì²´í¬ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
      CHECKS = {};
      localStorage.setItem(STORAGE_CHECKS, JSON.stringify(CHECKS));
      updateStats();
      updateTodayBox();
      render();
    });

    document.getElementById("exportBtn").addEventListener("click", exportBackup);

    document.getElementById("importFile").addEventListener("change", async (e) => {
      const file = e.target.files?.[0];
      if (!file) return;
      try {
        await importBackup(file);
        alert("ë°±ì—… ê°€ì ¸ì˜¤ê¸°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
      } catch {
        alert("ë°±ì—… íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      } finally {
        e.target.value = "";
      }
    });

    document.getElementById("startDate").addEventListener("change", (e) => {
      const v = (e.target.value || "").trim();
      if (!v) return;

      localStorage.setItem(STORAGE_START, v);
      rebuildMapsIfPossible();
      updateStats();
      updateTodayBox();
      render();
      maybeCelebrateMonthlyCompletion();
    });

    document.getElementById("viewMode").addEventListener("change", (e) => {
      VIEW_MODE = e.target.value;
      render();
    });

    document.getElementById("q").addEventListener("input", (e) => {
      FILTER = (e.target.value || "").trim();
      render();
    });

    document.getElementById("clearSearch").addEventListener("click", () => {
      FILTER = "";
      document.getElementById("q").value = "";
      render();
    });

    document.getElementById("goTodayBtn").addEventListener("click", () => {
      const start = localStorage.getItem(STORAGE_START) || document.getElementById("startDate").value;
      if (!start) { alert("ë¨¼ì € ì‹œì‘ì¼ì„ ì„¤ì •í•´ ì£¼ì„¸ìš”."); return; }

      // ì˜¤ëŠ˜ Dayê°€ ê²€ìƒ‰/í•„í„°ë¡œ ê°€ë ¤ì ¸ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ í’€ê³  ì´ë™
      VIEW_MODE = "all";
      document.getElementById("viewMode").value = "all";
      FILTER = "";
      document.getElementById("q").value = "";

      rebuildMapsIfPossible();
      updateTodayBox();
      render();

      const dayNum = dayIndexFromStartSkippingWeekends(start, new Date());

      // ë Œë”ê°€ ëë‚œ ë’¤ ìŠ¤í¬ë¡¤
      setTimeout(() => scrollToDay(dayNum), 0);
    });

    // ì¶•í•˜ ëª¨ë‹¬ ë‹«ê¸°
    document.getElementById("celebrateClose").addEventListener("click", () => {
      document.getElementById("overlay").style.display = "none";
    });
    document.getElementById("overlay").addEventListener("click", (e) => {
      if (e.target.id === "overlay") e.target.style.display = "none";
    });

    init();
  </script>
</body>
</html>
